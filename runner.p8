pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
--cave diver
--step 7

function _init()
 game_over=false
 make_cave()
 make_player()
end
 
function _update()
 if (not game_over) then
  update_cave()
  move_player()
  check_hit()
 else
  if (btnp(5)) _init() --restart
 end
end
 
function _draw()
 cls()
 draw_cave()
 draw_player()
 draw_hitbox()
 
 if (game_over) then
  print("game over!",44,44,7)
  print("your score:"..player.score,34,54,7)
  print("pressれ❎ to play again!",18,72,6)
 else
  print("score:"..player.score,2,2,7)
 end
end
-->8
function make_player()
 player={}
 player.x=24    --position
 player.y=60
 player.dy=0    --fall speed
 player.rise=1  --sprites
 player.fall=2
 player.dead=3
 player.speed=0.5 --fly speed
 player.score=0
end
 
function draw_player()
 if (game_over) then
  spr(player.dead,player.x,player.y)
 elseif (player.dy<0) then
  spr(player.rise,player.x,player.y)
 else
  spr(player.fall,player.x,player.y)
 end
end

function move_player()
 gravity=0.3 --bigger means more gravity!
 player.dy+=gravity --add gravity
 	
 --jump
 if (btnp(2)) then
  player.dy-=5
  sfx(0)
 end
 	
 --move to new position
 player.y+=player.dy
 
 --update score
 player.score+=player.speed
end

function box_hit(
  x1,y1,
  w1,h1,
  x2,y2,
  w2,h2)
  
  hit=false
  local xd=abs((x1+(w1/2))-(x2+(w2/2)))
  local xs=w1*0.5+w2*0.5
  local yd=abs((y1+(h1/2))-(y2+(h2/2)))
  local ys=h1/2+h2/2
  if xd<xs and 
     yd<ys then 
    hit=true 
  end
  
  return hit
end

function check_hit()
 
 for i=3,4 do
 	local mycave = cave[i]
  if (
   box_hit(
  		player.x,player.y,7,7,
  		i*8 - 8,mycave.top * 8,7,7
  	) or
  	box_hit(
  		player.x,player.y,7,7,
  		i*8 - 8,mycave.btm * 8,7,7
  	)
  ) then
   game_over=true
   sfx(1)
  end
 end
end
-->8
function make_cave()
 cave={{["top"]=1,["btm"]=15}}
 top=3 --how low can the ceiling go?
 btm=10 --how high can the floor get?
	x_cam_offset=0
end

function update_cave()
 --remove the back of the cave
 if (x_cam_offset>7) then
  del(cave,cave[1])
  x_cam_offset = 0
 end
 
 --add more cave
 while (#cave<17) do
  local col={}
  local up=flr(rnd(4)-2)
  local dwn=flr(rnd(4)-2)
  col.top=mid(1,cave[#cave].top+up,top)
  col.btm=mid(btm,cave[#cave].btm+dwn,16)
  add(cave,col)
 end
 x_cam_offset += player.speed
end

function draw_cave()
 camera(x_cam_offset,0)
 for i=1,#cave do
  spr(4,i*8-8,cave[i].top*8)
  spr(4,i*8-8,cave[i].btm*8)
 end
 camera()
end

function draw_hitbox()
 local i = 4
 local mycave = cave[i]
 if not mycave then
  return
 end
 rect(
				i*8 - 8,
  		mycave.top * 8,
  		i*8 + 7 - 8,
  		mycave.top * 8 + 7,
  		10
  )
end
__gfx__
0000000000aaaa0000aaaa0000888800333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaaaaa00aaaaaa00888888033bbbb330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700aa1aa1aaaaaaaaaa889889883bbbbbb30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000aaaaaaaaaa1aa1aa888888883bb33bb30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000aa1111aaaaaaaaaa888998883bb33bb30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700aaa11aaaaaa11aaa889889883bbbbbb30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaaaaa00aa11aa00888888033bbbb330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000aaaa0000aaaa0000888800333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555550555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555500055555005500555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555550555500055555000000555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555500555000055000000000500555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555505000505000005000000000000055555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555550000000005000005000000000000055555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555500000000000000000000000000000055050055555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555500000000000000000000000000000005000055555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555500000000000000000000000000000000000055555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000000000000005555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000000000000005550055
55555555555555555555555555555555555555555555555555555555555550555555555555055555500000000000000000000000000000000000000005500050
55555055555555555555555555555555555555555555555555555555555500555555055505055555500000000000000000000000000000000000000000500000
55500055555555555555555555555555555555555555555555555505555500055550000500055555000000000000000000000000000000000000000000000000
55500055505555555555555555555555555555555555505555555505555500055550000500000055000000000000000000000000000000000000000000000000
55000005005005555555555555555555555555555555505555555500555000055550000000000005000000000000000000000000000000000000000000000000
55000005000005555555555555555555555555555555500555555000555000005500000000000000000000000000000000000000000000000000000000000000
55000005000005555555555555555555555555555555000555555000055000000500000000000000000000000000000000000000000000000000000000000000
50000000000000505555555555555555555555555555000555555000050000000500000000000000000000000000000000000000000000000000000000000000
50000000000000005555555555555555555555555550000055500000000000000000000000000000000000000000000000000000000000000000000000000000
50000000000000000555555555555555555555555550000050500000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000050555555555555555555550550000050000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000555555555555555555550500000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000505555555555555555500500000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000005555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000555888805555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000508888885055555000000077077707770777000000770707077707770070000000000000000000000000000000000000000000000
00000000000000000000000088988988000555000000700070707770700000007070707070007070070000000000000000000000000000000000000000000000
00000000000000000000000088888888000000000000700077707070770000007070707077007700070000000000000000000000000000000000000000000000
00000000000000000000000088899888000000000000707070707070700000007070777070007070000000000000000000000000000000000000000000000000
00000000000000000000000088988988000000000000777070707070777000007700070077707070070000000000000000000000000000000000000000000000
00000000000000000000000008888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000007070077070707770000007700770077077707770000077707770777000000000000000000000000000000000000000
00000000000000000000000000000000007070707070707070000070007000707070707000070070707070707000000000000000000000000000000000000000
00000000000000000000000000000000007770707070707700000077707000707077007700000077707770707000000000000000000000000000000000000000
00000000000000000000000000000000000070707070707070000000707000707070707000070070707070707000000000000000000000000000000000000000
00000000000000000000000000000000007770770007707070000077000770770070707770000077707770777000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000066606660666006600660000006666600000066600660000066606000666060600000666006606660666066000600000000000000000000
00000000000000000060606060600060006000000066060660000006006060000060606000606060600000606060006060060060600600000000000000000000
00000000000000000066606600660066606660000066606660000006006060000066606000666066600000666060006660060060600600000000000000000000
00000000000000000060006060600000600060000066060660000006006060000060006000606000600000606060606060060060600000000000000000000000
00000000000000000060006060666066006600000006666600000006006600000060006660606066600000606066606060666060600600000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000050555500000000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000
00000000000000000055555500000000000000000000000000000000000000000000000000000000000000005555050000000000000000000000000000000000
00000000000000000555555500000000000000000000000000000000000000000005055000000000000000005555050000000000005000000000000000005000
00000000000000005555555550000000000000000000000000000000000000000005055500000000000000005555550000000000005500000000000000555005
00000000000000055555555555000000000000000000000000000000000000005005055500000000000000055555555000500500005555500000000055555005
00000000000000055555555555500000000000000000000000000000000000005055555500000000000000055555555000500500055555550000000555555555
00000000000000055555555555550000000000000000000050000000000500005555555550000000000000055555555500550555055555555500050555555555
00000000000000555555555555555000000000000000000555000000000500055555555555000000000000555555555505555555555555555500050555555555
00000000000000555555555555555000000000000000000555000000000500055555555555000000005000555555555505555555555555555500055555555555
00000000000000555555555555555555550000050000055555000000005555555555555555500000005005555555555555555555555555555550555555555555
00000000000005555555555555555555550000550000055555500000005555555555555555550000005505555555555555555555555555555555555555555555
00000000000005555555555555555555555000550000555555550050005555555555555555550000055555555555555555555555555555555555555555555555
00000000000555555555555555555555555505555005555555550055055555555555555555550000555555555555555555555555555555555555555555555555
00000000005555555555555555555555555555555055555555550055055555555555555555555500555555555555555555555555555555555555555555555555
00505000005555555555555555555555555555555055555555555555555555555555555555555550555555555555555555555555555555555555555555555555
05505000555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
05555055555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
05555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555

__sfx__
000400000e05011050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000a000032050000002a0500000022050000000904009030090300903009020090200902009010090100901000000000000000000000000000000000000000000000000000000000000000000000000000000000
