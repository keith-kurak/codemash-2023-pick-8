pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
jump_limit = 1

function _init()
 x=24
 y=10
 dy=0
 dx=0
 dead=0
 
 on_ground=false
 
 jump=0
 gen_map()
end

function _draw()
  cls()
  camera(x-24,0)
  map()
  spr(6,x,y)
  camera()
  print(flr(x/8),0,0)
  if dead == 1 then
  	print("dead",10,10)
  end
  --print(y,0,8)
end

function _update60()
		if hit(x,y,7,7,2) then
    dead=1
    return
  end
  dy=dy+0.05
  
  if btn(0) then
    dx=dx-0.05
  end
  
  if btn(1) then
    dx=dx+0.05
    if dx > 0.5 then
    	dx = 2
    end
  end
  
  if btnp(5) and 
    (on_ground or jump<jump_limit) then
    on_ground=false
    jump+=1
    dy=dy-2
  end
  
  if hit(x+dx,y,7,7,1) then
    dx=0
  end
  
  if hit(x,y+dy,7,7,1) then
    if dy>0 then
      on_ground=true
    end
    dy=0        
  end
  
  if on_ground then
    dx=dx*0.95
    jump=0
  end
  
  y=y+dy
  x=x+dx
  
  if x >= (127-12)*8 then
  	x = 24
  	gen_map()
  end
  
end
-->8
function hit(x,y,w,h,flag)
  collide=false
  for i=x,x+w,w do
    if (fget(mget(i/8,y/8))==flag) or
         (fget(mget(i/8,(y+h)/8))==flag) then
          collide=true
    end
  end
  
  for i=y,y+h,h do
    if (fget(mget(x/8,i/8))==flag) or
         (fget(mget((x+w)/8,i/8))==flag) then
          collide=true
    end
  end
  
  return collide
end
-->8
function gen_map()
 --clear
 for i=0,127 do
  for j=0,15 do
  	mset(i,j,3)
  end 
 end
 -- set flat space at begin/ end
	for i=0,15 do
		mset(i,15,1)
	end
	for i=112,127 do
		mset(i,15,1)
	end
	for i=16,111 do
	 for j=0,rnd(4) do
			mset(i,15-j,1)
			if rnd(100)>90 then
				mset(i,8,2)
			end
		end
 end
end
__gfx__
000000005555555500000000000000000000000000000000aaaaaaaa000000000000000000000000000000000000000000000000000000000000000000000000
0000000056dddd6508000080000000000000000000000000a870078a000000000000000000000000000000000000000000000000000000000000000000000000
007007005d6666d500888800000000000000000000000000a800008a000000000000000000000000000000000000000000000000000000000000000000000000
000770005d6dd6d50089980000000000000000000000000008077080000000000000000000000000000000000000000000000000000000000000000000000000
000770005d6dd6d50089980000000000000000000000000008000080000000000000000000000000000000000000000000000000000000000000000000000000
007007005d6666d50088880000000000000000000000000008888880000000000000000000000000000000000000000000000000000000000000000000000000
0000000056dddd650800008000000000000000000000000088800888000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555550000000000000000000000000000000080800808000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
